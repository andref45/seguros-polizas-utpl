-- WARNING: This schema is for context only and is not meant to be run.
-- Table order and constraints may not be valid for execution.

CREATE TABLE public.beneficiarios (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  poliza_id uuid NOT NULL,
  cedula character varying NOT NULL,
  nombres character varying NOT NULL,
  apellidos character varying NOT NULL,
  parentesco character varying NOT NULL,
  porcentaje_beneficio numeric NOT NULL CHECK (porcentaje_beneficio > 0::numeric AND porcentaje_beneficio <= 100::numeric),
  telefono character varying,
  email character varying,
  fecha_registro timestamp without time zone DEFAULT now(),
  CONSTRAINT beneficiarios_pkey PRIMARY KEY (id),
  CONSTRAINT beneficiarios_poliza_id_fkey FOREIGN KEY (poliza_id) REFERENCES public.polizas(id)
);
CREATE TABLE public.copagos_config (
  id integer NOT NULL DEFAULT nextval('copagos_config_id_seq'::regclass),
  esquema character varying NOT NULL UNIQUE,
  porcentaje_institucion numeric NOT NULL,
  porcentaje_empleado numeric NOT NULL,
  activo boolean DEFAULT true,
  CONSTRAINT copagos_config_pkey PRIMARY KEY (id)
);
CREATE TABLE public.documentos (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  siniestro_id uuid NOT NULL,
  tipo character varying NOT NULL,
  url text NOT NULL,
  hash character varying,
  estado_doc character varying DEFAULT 'Pendiente'::character varying,
  creado_en timestamp without time zone DEFAULT now(),
  CONSTRAINT documentos_pkey PRIMARY KEY (id),
  CONSTRAINT documentos_siniestro_id_fkey FOREIGN KEY (siniestro_id) REFERENCES public.siniestros(id)
);
CREATE TABLE public.pagos (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  poliza_id uuid NOT NULL,
  monto numeric NOT NULL,
  fecha_pago timestamp without time zone DEFAULT now(),
  fecha_vencimiento date NOT NULL,
  estado character varying DEFAULT 'pendiente'::character varying CHECK (estado::text = ANY (ARRAY['pendiente'::character varying, 'pagado'::character varying, 'vencido'::character varying, 'parcial'::character varying]::text[])),
  metodo_pago character varying,
  referencia_pago character varying,
  mes_periodo integer NOT NULL CHECK (mes_periodo >= 1 AND mes_periodo <= 12),
  anio_periodo integer NOT NULL,
  fecha_registro timestamp without time zone DEFAULT now(),
  monto_empleado numeric DEFAULT 0,
  monto_institucion numeric DEFAULT 0,
  estado_temporalidad character varying DEFAULT 'ORDINARIO'::character varying,
  regla_copago character varying,
  CONSTRAINT pagos_pkey PRIMARY KEY (id),
  CONSTRAINT pagos_poliza_id_fkey FOREIGN KEY (poliza_id) REFERENCES public.polizas(id)
);
CREATE TABLE public.polizas (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  numero_poliza character varying NOT NULL UNIQUE,
  usuario_id uuid NOT NULL,
  tipo_poliza_id integer NOT NULL,
  fecha_inicio date NOT NULL,
  fecha_fin date NOT NULL,
  estado character varying DEFAULT 'activa'::character varying CHECK (estado::text = ANY (ARRAY['activa'::character varying, 'vencida'::character varying, 'cancelada'::character varying, 'suspendida'::character varying]::text[])),
  prima_mensual numeric NOT NULL,
  cobertura_total numeric NOT NULL,
  fecha_contratacion timestamp without time zone DEFAULT now(),
  ultima_actualizacion timestamp without time zone DEFAULT now(),
  copago_id integer,
  vigencia_id integer,
  CONSTRAINT polizas_pkey PRIMARY KEY (id),
  CONSTRAINT polizas_usuario_id_fkey FOREIGN KEY (usuario_id) REFERENCES public.usuarios(id),
  CONSTRAINT polizas_tipo_poliza_id_fkey FOREIGN KEY (tipo_poliza_id) REFERENCES public.tipos_poliza(id),
  CONSTRAINT polizas_copago_id_fkey FOREIGN KEY (copago_id) REFERENCES public.copagos_config(id),
  CONSTRAINT polizas_vigencia_id_fkey FOREIGN KEY (vigencia_id) REFERENCES public.vigencias(id)
);
CREATE TABLE public.sesiones (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  usuario_id uuid NOT NULL,
  token text NOT NULL,
  estado character varying DEFAULT 'activo'::character varying,
  creado_en timestamp without time zone DEFAULT now(),
  CONSTRAINT sesiones_pkey PRIMARY KEY (id),
  CONSTRAINT sesiones_usuario_id_fkey FOREIGN KEY (usuario_id) REFERENCES auth.users(id)
);
CREATE TABLE public.siniestros (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  numero_siniestro character varying NOT NULL UNIQUE,
  poliza_id uuid NOT NULL,
  fecha_siniestro date NOT NULL,
  descripcion text NOT NULL,
  monto_reclamado numeric NOT NULL,
  monto_coaseguro numeric,
  monto_aprobado numeric,
  estado character varying DEFAULT 'reportado'::character varying CHECK (estado::text = ANY (ARRAY['Reportado'::character varying, 'En_tramite'::character varying, 'Pagado'::character varying, 'Rechazado'::character varying]::text[])),
  evidencia_url text,
  observaciones text,
  fecha_reporte timestamp without time zone DEFAULT now(),
  fecha_resolucion timestamp without time zone,
  ultima_actualizacion timestamp without time zone DEFAULT now(),
  causa character varying,
  cedula_fallecido character varying,
  fecha_defuncion date,
  monto_autorizado numeric CHECK (monto_autorizado >= 0::numeric),
  monto_pagado numeric CHECK (monto_pagado >= 0::numeric),
  source character varying DEFAULT 'web'::character varying CHECK (source::text = ANY (ARRAY['web'::character varying, 'email'::character varying, 'manual'::character varying]::text[])),
  CONSTRAINT siniestros_pkey PRIMARY KEY (id),
  CONSTRAINT siniestros_poliza_id_fkey FOREIGN KEY (poliza_id) REFERENCES public.polizas(id)
);
CREATE TABLE public.tipos_poliza (
  id integer NOT NULL DEFAULT nextval('tipos_poliza_id_seq'::regclass),
  nombre character varying NOT NULL,
  descripcion text,
  cobertura_maxima numeric NOT NULL,
  prima_mensual numeric NOT NULL,
  porcentaje_coaseguro numeric DEFAULT 20.00,
  deducible numeric DEFAULT 0,
  estado character varying DEFAULT 'activo'::character varying CHECK (estado::text = ANY (ARRAY['activo'::character varying, 'inactivo'::character varying]::text[])),
  fecha_creacion timestamp without time zone DEFAULT now(),
  CONSTRAINT tipos_poliza_pkey PRIMARY KEY (id)
);
CREATE TABLE public.usuarios (
  id uuid NOT NULL,
  cedula character varying NOT NULL UNIQUE,
  nombres character varying NOT NULL,
  apellidos character varying NOT NULL,
  telefono character varying,
  tipo_usuario character varying NOT NULL CHECK (tipo_usuario::text = ANY (ARRAY['empleado'::character varying, 'estudiante'::character varying]::text[])),
  fecha_nacimiento date NOT NULL,
  direccion text,
  estado character varying DEFAULT 'activo'::character varying CHECK (estado::text = ANY (ARRAY['activo'::character varying, 'inactivo'::character varying]::text[])),
  fecha_registro timestamp without time zone DEFAULT now(),
  ultima_actualizacion timestamp without time zone DEFAULT now(),
  CONSTRAINT usuarios_pkey PRIMARY KEY (id),
  CONSTRAINT usuarios_id_fkey FOREIGN KEY (id) REFERENCES auth.users(id)
);
CREATE TABLE public.vigencias (
  id integer NOT NULL DEFAULT nextval('vigencias_id_seq'::regclass),
  anio integer NOT NULL UNIQUE,
  estado character varying DEFAULT 'cerrado'::character varying,
  fecha_inicio date NOT NULL,
  fecha_fin date NOT NULL,
  CONSTRAINT vigencias_pkey PRIMARY KEY (id)
);